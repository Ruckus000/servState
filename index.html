<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ServState | Mortgage Servicing</title>

    <!-- React 18 from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet" />

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Plus Jakarta Sans', 'system-ui', 'sans-serif'],
                    },
                    colors: {
                        border: 'hsl(var(--border))',
                        input: 'hsl(var(--input))',
                        background: 'hsl(var(--background))',
                        foreground: 'hsl(var(--foreground))',
                        primary: {
                            DEFAULT: 'hsl(var(--primary))',
                            foreground: 'hsl(var(--primary-foreground))',
                        },
                        secondary: {
                            DEFAULT: 'hsl(var(--secondary))',
                            foreground: 'hsl(var(--secondary-foreground))',
                        },
                        muted: {
                            DEFAULT: 'hsl(var(--muted))',
                            foreground: 'hsl(var(--muted-foreground))',
                        },
                        accent: {
                            DEFAULT: 'hsl(var(--accent))',
                            foreground: 'hsl(var(--accent-foreground))',
                        },
                        card: {
                            DEFAULT: 'hsl(var(--card))',
                            foreground: 'hsl(var(--card-foreground))',
                        },
                        destructive: {
                            DEFAULT: 'hsl(var(--destructive))',
                            foreground: 'hsl(var(--destructive-foreground))',
                        },
                    },
                },
            },
        }
    </script>

    <style>
        :root {
            --background: 0 0% 100%;
            --foreground: 222.2 84% 4.9%;
            --card: 0 0% 100%;
            --card-foreground: 222.2 84% 4.9%;
            --primary: 221.2 83.2% 53.3%;
            --primary-foreground: 210 40% 98%;
            --secondary: 210 40% 96.1%;
            --secondary-foreground: 222.2 47.4% 11.2%;
            --muted: 210 40% 96.1%;
            --muted-foreground: 215.4 16.3% 46.9%;
            --accent: 210 40% 96.1%;
            --accent-foreground: 222.2 47.4% 11.2%;
            --destructive: 0 84.2% 60.2%;
            --destructive-foreground: 210 40% 98%;
            --border: 214.3 31.8% 91.4%;
            --input: 214.3 31.8% 91.4%;
            --radius: 0.5rem;
        }

        * {
            border-color: hsl(var(--border));
        }

        body {
            font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
            background-color: hsl(var(--background));
            color: hsl(var(--foreground));
        }
    </style>
</head>

<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React

        // ============ UI COMPONENTS ============

        const Icon = ({ name, size = 20, className = '', ...props }) => {
            useEffect(() => {
                if (window.lucide) {
                    window.lucide.createIcons()
                }
            }, [])

            return React.createElement('i', {
                'data-lucide': name,
                className: className,
                style: { width: size, height: size },
                ...props,
            })
        }

        const Button = ({
            children,
            variant = 'default',
            size = 'default',
            className = '',
            ...props
        }) => {
            const baseStyles = 'inline-flex items-center justify-center rounded-md font-medium transition-colors focus-visible:outline-none disabled:pointer-events-none disabled:opacity-50'

            const variants = {
                default: 'bg-primary text-primary-foreground hover:bg-primary/90',
                secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',
                outline: 'border border-input bg-background hover:bg-accent hover:text-accent-foreground',
                ghost: 'hover:bg-accent hover:text-accent-foreground',
                destructive: 'bg-destructive text-destructive-foreground hover:bg-destructive/90',
            }

            const sizes = {
                default: 'h-10 px-4 py-2',
                sm: 'h-9 rounded-md px-3',
                lg: 'h-11 rounded-md px-8',
            }

            return (
                <button
                    className={`${baseStyles} ${variants[variant]} ${sizes[size]} ${className}`}
                    {...props}
                >
                    {children}
                </button>
            )
        }

        const Card = ({ children, className = '', hover = false }) => (
            <div
                className={`rounded-lg border bg-card text-card-foreground shadow-sm p-6 ${hover ? 'transition-shadow hover:shadow-md cursor-pointer' : ''
                    } ${className}`}
            >
                {children}
            </div>
        )

        const Input = ({ className = '', ...props }) => (
            <input
                className={`flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 ${className}`}
                {...props}
            />
        )

        const Badge = ({ children, variant = 'default', className = '' }) => {
            const variants = {
                default: 'bg-primary text-primary-foreground hover:bg-primary/80',
                secondary: 'bg-secondary text-secondary-foreground hover:bg-secondary/80',
                outline: 'text-foreground border border-input',
                success: 'bg-green-500 text-white',
                warning: 'bg-amber-500 text-white',
                destructive: 'bg-destructive text-destructive-foreground',
            }

            return (
                <span className={`inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-semibold transition-colors ${variants[variant]} ${className}`}>
                    {children}
                </span>
            )
        }

        const Modal = ({ open, onClose, title, children, maxWidth = 'max-w-md' }) => {
            if (!open) return null

            return (
                <div className="fixed inset-0 z-50 flex items-center justify-center">
                    <div className="fixed inset-0 bg-black/50" onClick={onClose} />
                    <div className={`relative bg-card rounded-lg shadow-lg ${maxWidth} w-full mx-4 p-6 z-10 animate-in fade-in duration-200`}>
                        <div className="flex items-center justify-between mb-4">
                            <h2 className="text-xl font-semibold">{title}</h2>
                            <button
                                onClick={onClose}
                                className="text-muted-foreground hover:text-foreground transition-colors"
                            >
                                <Icon name="x" size={20} />
                            </button>
                        </div>
                        <div>{children}</div>
                    </div>
                </div>
            )
        }

        const StatCard = ({ title, value, icon, subtitle, trend }) => (
            <Card>
                <div className="flex items-start justify-between">
                    <div>
                        <p className="text-sm font-medium text-muted-foreground mb-1">{title}</p>
                        <p className="text-2xl font-bold">{value}</p>
                        {subtitle && <p className="text-xs text-muted-foreground mt-1">{subtitle}</p>}
                        {trend && (
                            <div className="flex items-center gap-1 mt-2">
                                <Icon
                                    name={trend > 0 ? 'trending-up' : 'trending-down'}
                                    size={14}
                                    className={trend > 0 ? 'text-green-500' : 'text-red-500'}
                                />
                                <span className={`text-xs ${trend > 0 ? 'text-green-500' : 'text-red-500'}`}>
                                    {Math.abs(trend)}%
                                </span>
                            </div>
                        )}
                    </div>
                    {icon && (
                        <div className={`p-3 rounded-lg ${icon.bg}`}>
                            <Icon name={icon.name} size={24} className={icon.color} />
                        </div>
                    )}
                </div>
            </Card>
        )

        const Sidebar = ({ items, activeView, onNavigate, collapsed = false }) => (
            <div className={`${collapsed ? 'w-16' : 'w-64'} border-r bg-card transition-all duration-300`}>
                <nav className="p-4 space-y-2">
                    {items.map((item) => (
                        <button
                            key={item.id}
                            onClick={() => onNavigate(item.id)}
                            className={`w-full flex items-center gap-3 px-4 py-3 rounded-lg transition-colors ${activeView === item.id
                                ? 'bg-primary text-primary-foreground'
                                : 'hover:bg-accent hover:text-accent-foreground'
                                }`}
                        >
                            <Icon name={item.icon} size={20} />
                            {!collapsed && <span className="font-medium">{item.label}</span>}
                            {!collapsed && item.badge && (
                                <Badge variant="destructive" className="ml-auto">
                                    {item.badge}
                                </Badge>
                            )}
                        </button>
                    ))}
                </nav>
            </div>
        )

        const DataTable = ({ columns, data, onRowClick }) => {
            const [sortColumn, setSortColumn] = useState(null)
            const [sortDirection, setSortDirection] = useState('asc')

            const handleSort = (key) => {
                if (sortColumn === key) {
                    setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')
                } else {
                    setSortColumn(key)
                    setSortDirection('asc')
                }
            }

            const sortedData = useMemo(() => {
                if (!sortColumn) return data

                return [...data].sort((a, b) => {
                    const aVal = a[sortColumn]
                    const bVal = b[sortColumn]

                    if (typeof aVal === 'number' && typeof bVal === 'number') {
                        return sortDirection === 'asc' ? aVal - bVal : bVal - aVal
                    }

                    const aStr = String(aVal).toLowerCase()
                    const bStr = String(bVal).toLowerCase()

                    if (sortDirection === 'asc') {
                        return aStr.localeCompare(bStr)
                    } else {
                        return bStr.localeCompare(aStr)
                    }
                })
            }, [data, sortColumn, sortDirection])

            return (
                <div className="border rounded-lg overflow-hidden">
                    <table className="w-full">
                        <thead className="bg-muted">
                            <tr>
                                {columns.map((col) => (
                                    <th
                                        key={col.key}
                                        className={`px-4 py-3 text-left text-sm font-medium ${col.sortable !== false ? 'cursor-pointer hover:bg-muted/80' : ''
                                            } ${col.className || ''}`}
                                        onClick={() => col.sortable !== false && handleSort(col.key)}
                                    >
                                        <div className="flex items-center gap-2">
                                            {col.label}
                                            {sortColumn === col.key && (
                                                <Icon
                                                    name={sortDirection === 'asc' ? 'chevron-up' : 'chevron-down'}
                                                    size={14}
                                                />
                                            )}
                                        </div>
                                    </th>
                                ))}
                            </tr>
                        </thead>
                        <tbody>
                            {sortedData.map((row, idx) => (
                                <tr
                                    key={idx}
                                    className={`border-t ${onRowClick ? 'cursor-pointer hover:bg-accent' : ''
                                        }`}
                                    onClick={() => onRowClick && onRowClick(row)}
                                >
                                    {columns.map((col) => (
                                        <td
                                            key={col.key}
                                            className={`px-4 py-3 text-sm ${col.className || ''}`}
                                        >
                                            {col.render ? col.render(row[col.key], row) : row[col.key]}
                                        </td>
                                    ))}
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            )
        }

        const BorrowerDashboard = ({ loan, transactions, onMakePayment }) => {
            const monthlyPayment = loan.monthly_pi + loan.monthly_escrow
            const lastPayment = transactions[0]
            const paymentDue = new Date(loan.next_due_date)
            const today = new Date()
            const daysUntilDue = Math.ceil((paymentDue - today) / (1000 * 60 * 60 * 24))

            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-3xl font-bold mb-2">Welcome back, {loan.borrower_name.split(' ')[0]}</h2>
                        <p className="text-muted-foreground">Loan #{loan.loan_number}</p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        <StatCard
                            title="Current Balance"
                            value={`$${loan.current_principal.toLocaleString()}`}
                            subtitle={`of $${loan.original_balance.toLocaleString()} original`}
                            icon={{ name: 'dollar-sign', bg: 'bg-blue-500/10', color: 'text-blue-600' }}
                        />
                        <StatCard
                            title="Monthly Payment"
                            value={`$${monthlyPayment.toLocaleString()}`}
                            subtitle="Principal, Interest & Escrow"
                            icon={{ name: 'calendar', bg: 'bg-green-500/10', color: 'text-green-600' }}
                        />
                        <StatCard
                            title="Interest Rate"
                            value={`${loan.interest_rate}%`}
                            subtitle="Fixed rate"
                            icon={{ name: 'percent', bg: 'bg-purple-500/10', color: 'text-purple-600' }}
                        />
                        <StatCard
                            title="Next Payment"
                            value={daysUntilDue > 0 ? `${daysUntilDue} days` : 'Due Today'}
                            subtitle={new Date(loan.next_due_date).toLocaleDateString()}
                            icon={{ name: 'clock', bg: 'bg-amber-500/10', color: 'text-amber-600' }}
                        />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card>
                            <h3 className="text-lg font-semibold mb-4">Recent Payment</h3>
                            {lastPayment ? (
                                <div className="space-y-3">
                                    <div className="flex justify-between items-center">
                                        <span className="text-muted-foreground">Payment Date</span>
                                        <span className="font-medium">{new Date(lastPayment.date).toLocaleDateString()}</span>
                                    </div>
                                    <div className="flex justify-between items-center">
                                        <span className="text-muted-foreground">Amount Paid</span>
                                        <span className="font-medium">${lastPayment.amount.toLocaleString()}</span>
                                    </div>
                                    <div className="border-t pt-3 space-y-2 text-sm">
                                        <div className="flex justify-between">
                                            <span className="text-muted-foreground">Principal</span>
                                            <span>${lastPayment.principal.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-muted-foreground">Interest</span>
                                            <span>${lastPayment.interest.toLocaleString()}</span>
                                        </div>
                                        <div className="flex justify-between">
                                            <span className="text-muted-foreground">Escrow</span>
                                            <span>${lastPayment.escrow.toLocaleString()}</span>
                                        </div>
                                    </div>
                                </div>
                            ) : (
                                <p className="text-muted-foreground">No recent payments</p>
                            )}
                        </Card>

                        <Card>
                            <h3 className="text-lg font-semibold mb-4">Loan Summary</h3>
                            <div className="space-y-3">
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Loan Type</span>
                                    <span className="font-medium">{loan.loan_type}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Property Address</span>
                                    <span className="font-medium text-right text-sm">{loan.property_address}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Origination Date</span>
                                    <span className="font-medium">{new Date(loan.origination_date).toLocaleDateString()}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Remaining Term</span>
                                    <span className="font-medium">{loan.months_remaining} months</span>
                                </div>
                            </div>
                        </Card>
                    </div>

                    <Card>
                        <div className="flex items-center justify-between mb-4">
                            <h3 className="text-lg font-semibold">Quick Actions</h3>
                        </div>
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                            <Button variant="outline" className="justify-start" onClick={onMakePayment}>
                                <Icon name="credit-card" size={16} className="mr-2" />
                                Make a Payment
                            </Button>
                            <Button variant="outline" className="justify-start">
                                <Icon name="file-text" size={16} className="mr-2" />
                                View Documents
                            </Button>
                            <Button variant="outline" className="justify-start">
                                <Icon name="mail" size={16} className="mr-2" />
                                Contact Support
                            </Button>
                        </div>
                    </Card>
                </div >
            )
        }

        const BorrowerPayments = ({ loan, transactions, onMakePayment }) => {
            const monthlyPayment = loan.monthly_pi + loan.monthly_escrow

            const columns = [
                {
                    key: 'date',
                    label: 'Date',
                    render: (val) => new Date(val).toLocaleDateString(),
                },
                {
                    key: 'type',
                    label: 'Type',
                    render: (val) => <Badge variant="outline">{val}</Badge>,
                },
                {
                    key: 'amount',
                    label: 'Amount',
                    className: 'text-right',
                    render: (val) => `$${val.toLocaleString()}`,
                },
                {
                    key: 'principal',
                    label: 'Principal',
                    className: 'text-right',
                    render: (val) => `$${val.toLocaleString()}`,
                },
                {
                    key: 'interest',
                    label: 'Interest',
                    className: 'text-right',
                    render: (val) => `$${val.toLocaleString()}`,
                },
                {
                    key: 'escrow',
                    label: 'Escrow',
                    className: 'text-right',
                    render: (val) => `$${val.toLocaleString()}`,
                },
                {
                    key: 'status',
                    label: 'Status',
                    render: (val) => (
                        <Badge variant={val === 'Posted' ? 'success' : 'warning'}>
                            {val}
                        </Badge>
                    ),
                },
            ]

            return (
                <div className="space-y-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-3xl font-bold">Payments</h2>
                            <p className="text-muted-foreground mt-1">
                                Payment history and manage automatic payments
                            </p>
                        </div>
                        <Button onClick={onMakePayment}>
                            <Icon name="credit-card" size={16} className="mr-2" />
                            Make a Payment
                        </Button>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <StatCard
                            title="Monthly Payment"
                            value={`$${monthlyPayment.toLocaleString()}`}
                            subtitle="Due on 1st of each month"
                            icon={{ name: 'calendar', bg: 'bg-blue-500/10', color: 'text-blue-600' }}
                        />
                        <StatCard
                            title="Last Payment"
                            value={`$${transactions[0]?.amount.toLocaleString() || '0.00'}`}
                            subtitle={transactions[0] ? new Date(transactions[0].date).toLocaleDateString() : 'No payments'}
                            icon={{ name: 'check-circle', bg: 'bg-green-500/10', color: 'text-green-600' }}
                        />
                        <StatCard
                            title="Year to Date"
                            value={`$${transactions.reduce((sum, t) => sum + t.amount, 0).toLocaleString()}`}
                            subtitle={`${transactions.length} payments made`}
                            icon={{ name: 'trending-up', bg: 'bg-purple-500/10', color: 'text-purple-600' }}
                        />
                    </div>

                    <Card>
                        <h3 className="text-lg font-semibold mb-4">Payment History</h3>
                        <DataTable columns={columns} data={transactions} />
                    </Card>
                </div>
            )
        }

        const PaymentModal = ({ open, onClose, loan, onSubmit }) => {
            const [amount, setAmount] = useState(loan.monthly_pi + loan.monthly_escrow)

            if (!loan) return null

            const totalDue = loan.monthly_pi + loan.monthly_escrow
            const interest = loan.current_principal * (loan.interest_rate / 100 / 12)
            const principal = Math.max(0, amount - interest - loan.monthly_escrow)

            const handleSubmit = (e) => {
                e.preventDefault()
                onSubmit(amount)
                onClose()
            }

            return (
                <Modal open={open} onClose={onClose} title="Make a Payment" maxWidth="max-w-lg">
                    <form onSubmit={handleSubmit} className="space-y-6">
                        <div>
                            <p className="text-sm text-muted-foreground mb-1">
                                Loan #{loan.loan_number}
                            </p>
                            <p className="font-medium">{loan.borrower_name}</p>
                        </div>

                        <div className="space-y-2">
                            <label className="text-sm font-medium">Payment Amount</label>
                            <div className="relative">
                                <span className="absolute left-4 top-3 text-muted-foreground text-lg">$</span>
                                <Input
                                    type="number"
                                    value={amount}
                                    onChange={(e) => setAmount(parseFloat(e.target.value) || 0)}
                                    className="pl-8 text-2xl font-bold h-14"
                                    step="0.01"
                                    min="0"
                                />
                            </div>
                            <p className="text-xs text-muted-foreground">
                                Minimum due: ${totalDue.toLocaleString()}
                            </p>
                        </div>

                        <Card className="bg-muted/30">
                            <p className="text-xs font-semibold uppercase tracking-wider text-muted-foreground mb-3">
                                Payment Allocation
                            </p>
                            <div className="space-y-2 text-sm">
                                <div className="flex justify-between">
                                    <span>Interest</span>
                                    <span>${interest.toFixed(2)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Escrow</span>
                                    <span>${loan.monthly_escrow.toFixed(2)}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span>Principal</span>
                                    <span>${principal.toFixed(2)}</span>
                                </div>
                                <div className="border-t pt-2 flex justify-between font-bold">
                                    <span>Total</span>
                                    <span>${amount.toFixed(2)}</span>
                                </div>
                            </div>
                        </Card>

                        <div className="space-y-2">
                            <label className="text-sm font-medium">Payment Method</label>
                            <select className="flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm">
                                <option>Bank Account ****1234</option>
                                <option>Credit Card ****5678</option>
                            </select>
                        </div>

                        <div className="flex gap-3">
                            <Button type="button" variant="outline" onClick={onClose} className="flex-1">
                                Cancel
                            </Button>
                            <Button type="submit" className="flex-1">
                                Submit Payment
                            </Button>
                        </div>
                    </form>
                </Modal>
            )
        }

        const BorrowerDocuments = ({ documents }) => {
            const [filter, setFilter] = useState('all')

            const filteredDocs = filter === 'all'
                ? documents
                : documents.filter(d => d.type === filter)

            const docTypes = ['all', ...new Set(documents.map(d => d.type))]

            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-3xl font-bold">Documents</h2>
                        <p className="text-muted-foreground mt-1">
                            View and download your loan documents
                        </p>
                    </div>

                    <div className="flex gap-2">
                        {docTypes.map(type => (
                            <Button
                                key={type}
                                variant={filter === type ? 'default' : 'outline'}
                                size="sm"
                                onClick={() => setFilter(type)}
                            >
                                {type === 'all' ? 'All Documents' : type}
                            </Button>
                        ))}
                    </div>

                    <div className="grid grid-cols-1 gap-4">
                        {filteredDocs.map(doc => (
                            <Card key={doc.id} hover>
                                <div className="flex items-center justify-between">
                                    <div className="flex items-center gap-4">
                                        <div className="p-3 bg-blue-500/10 rounded-lg">
                                            <Icon name="file-text" size={24} className="text-blue-600" />
                                        </div>
                                        <div>
                                            <h3 className="font-semibold">{doc.name}</h3>
                                            <div className="flex items-center gap-3 mt-1">
                                                <Badge variant="outline">{doc.type}</Badge>
                                                <span className="text-sm text-muted-foreground">
                                                    {new Date(doc.date).toLocaleDateString()}
                                                </span>
                                                <span className="text-sm text-muted-foreground">{doc.size}</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="flex gap-2">
                                        <Button variant="ghost" size="sm">
                                            <Icon name="eye" size={16} className="mr-2" />
                                            View
                                        </Button>
                                        <Button variant="ghost" size="sm">
                                            <Icon name="download" size={16} className="mr-2" />
                                            Download
                                        </Button>
                                    </div>
                                </div>
                            </Card>
                        ))}
                    </div>

                    {filteredDocs.length === 0 && (
                        <Card>
                            <div className="text-center py-12">
                                <Icon name="inbox" size={48} className="mx-auto text-muted-foreground mb-4" />
                                <p className="text-muted-foreground">No documents found</p>
                            </div>
                        </Card>
                    )}
                </div>
            )
        }

        const BorrowerEscrow = ({ loan }) => {
            const escrowTransactions = [
                { id: 1, date: '2023-12-15', type: 'Property Tax', amount: -2400, balance: 4200 },
                { id: 2, date: '2023-12-01', type: 'Homeowner Insurance', amount: -1200, balance: 6600 },
                { id: 3, date: '2023-12-01', type: 'Monthly Deposit', amount: 650, balance: 7800 },
                { id: 4, date: '2023-11-01', type: 'Monthly Deposit', amount: 650, balance: 7150 },
            ]

            const currentBalance = escrowTransactions[0].balance
            const monthlyDeposit = loan.monthly_escrow
            const annualTaxes = 4800
            const annualInsurance = 2400
            const projectedShortage = 0

            const columns = [
                {
                    key: 'date',
                    label: 'Date',
                    render: (val) => new Date(val).toLocaleDateString(),
                },
                {
                    key: 'type',
                    label: 'Description',
                },
                {
                    key: 'amount',
                    label: 'Amount',
                    className: 'text-right',
                    render: (val) => (
                        <span className={val > 0 ? 'text-green-600' : 'text-red-600'}>
                            {val > 0 ? '+' : ''}${Math.abs(val).toLocaleString()}
                        </span>
                    ),
                },
                {
                    key: 'balance',
                    label: 'Balance',
                    className: 'text-right',
                    render: (val) => `$${val.toLocaleString()}`,
                },
            ]

            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-3xl font-bold">Escrow Analysis</h2>
                        <p className="text-muted-foreground mt-1">
                            Track your tax and insurance payments
                        </p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <StatCard
                            title="Escrow Balance"
                            value={`$${currentBalance.toLocaleString()}`}
                            subtitle="Available for disbursements"
                            icon={{ name: 'piggy-bank', bg: 'bg-blue-500/10', color: 'text-blue-600' }}
                        />
                        <StatCard
                            title="Monthly Deposit"
                            value={`$${monthlyDeposit.toLocaleString()}`}
                            subtitle="Part of your monthly payment"
                            icon={{ name: 'arrow-down-circle', bg: 'bg-green-500/10', color: 'text-green-600' }}
                        />
                        <StatCard
                            title="Projected Shortage"
                            value={`$${projectedShortage.toLocaleString()}`}
                            subtitle="Estimated for next analysis"
                            icon={{ name: 'alert-circle', bg: 'bg-amber-500/10', color: 'text-amber-600' }}
                        />
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <Card>
                            <h3 className="text-lg font-semibold mb-4">Upcoming Disbursements</h3>
                            <div className="space-y-4">
                                <div className="flex items-center justify-between p-3 border rounded-lg">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-muted rounded-md">
                                            <Icon name="home" size={20} />
                                        </div>
                                        <div>
                                            <p className="font-medium">County Property Tax</p>
                                            <p className="text-xs text-muted-foreground">Due June 15, 2024</p>
                                        </div>
                                    </div>
                                    <span className="font-bold">$2,400.00</span>
                                </div>
                                <div className="flex items-center justify-between p-3 border rounded-lg">
                                    <div className="flex items-center gap-3">
                                        <div className="p-2 bg-muted rounded-md">
                                            <Icon name="shield" size={20} />
                                        </div>
                                        <div>
                                            <p className="font-medium">Homeowner Insurance</p>
                                            <p className="text-xs text-muted-foreground">Due Dec 01, 2024</p>
                                        </div>
                                    </div>
                                    <span className="font-bold">$1,200.00</span>
                                </div>
                            </div>
                        </Card>

                        <Card>
                            <h3 className="text-lg font-semibold mb-4">Escrow Summary</h3>
                            <div className="space-y-3 text-sm">
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Annual Taxes</span>
                                    <span className="font-medium">${annualTaxes.toLocaleString()}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Annual Insurance</span>
                                    <span className="font-medium">${annualInsurance.toLocaleString()}</span>
                                </div>
                                <div className="flex justify-between">
                                    <span className="text-muted-foreground">Total Annual Disbursements</span>
                                    <span className="font-medium">${(annualTaxes + annualInsurance).toLocaleString()}</span>
                                </div>
                                <div className="border-t pt-2 flex justify-between font-bold">
                                    <span>Required Monthly Deposit</span>
                                    <span>${((annualTaxes + annualInsurance) / 12).toLocaleString()}</span>
                                </div>
                            </div>
                        </Card>
                    </div>

                    <Card>
                        <h3 className="text-lg font-semibold mb-4">Escrow History</h3>
                        <DataTable columns={columns} data={escrowTransactions} />
                    </Card>
                </div>
            )
        }

        const BorrowerMessages = ({ messages }) => {
            const [selectedMessage, setSelectedMessage] = useState(null)
            const [showCompose, setShowCompose] = useState(false)

            return (
                <div className="h-[calc(100vh-12rem)] min-h-[500px] flex gap-6">
                    {/* Message List */}
                    <Card className="w-1/3 flex flex-col p-0 overflow-hidden">
                        <div className="p-4 border-b flex justify-between items-center bg-muted/10">
                            <h2 className="font-bold text-lg">Inbox</h2>
                            <Button size="sm" onClick={() => setShowCompose(true)}>
                                <Icon name="plus" size={16} className="mr-2" />
                                New Message
                            </Button>
                        </div>
                        <div className="flex-1 overflow-y-auto">
                            {messages.map((msg) => (
                                <div
                                    key={msg.id}
                                    onClick={() => setSelectedMessage(msg)}
                                    className={`p-4 border-b cursor-pointer hover:bg-muted/50 transition-colors ${selectedMessage?.id === msg.id ? 'bg-muted/50 border-l-4 border-l-primary' : 'border-l-4 border-l-transparent'
                                        }`}
                                >
                                    <div className="flex justify-between items-start mb-1">
                                        <span className={`font-medium ${msg.unread ? 'text-foreground' : 'text-muted-foreground'}`}>
                                            {msg.sender}
                                        </span>
                                        <span className="text-xs text-muted-foreground">
                                            {new Date(msg.date).toLocaleDateString()}
                                        </span>
                                    </div>
                                    <div className="flex items-center gap-2 mb-1">
                                        {msg.unread && (
                                            <div className="w-2 h-2 rounded-full bg-blue-500 flex-shrink-0" />
                                        )}
                                        <p className={`text-sm truncate ${msg.unread ? 'font-semibold text-foreground' : 'text-muted-foreground'}`}>
                                            {msg.subject}
                                        </p>
                                    </div>
                                    <p className="text-xs text-muted-foreground line-clamp-2">
                                        {msg.preview}
                                    </p>
                                </div>
                            ))}
                        </div>
                    </Card>

                    {/* Message Detail */}
                    <Card className="flex-1 flex flex-col p-0 overflow-hidden">
                        {selectedMessage ? (
                            <>
                                <div className="p-6 border-b bg-muted/10">
                                    <div className="flex justify-between items-start mb-4">
                                        <div>
                                            <h2 className="text-2xl font-bold mb-2">{selectedMessage.subject}</h2>
                                            <div className="flex items-center gap-2 text-sm text-muted-foreground">
                                                <span>From: <span className="font-medium text-foreground">{selectedMessage.sender}</span></span>
                                                <span>â€¢</span>
                                                <span>{new Date(selectedMessage.date).toLocaleString()}</span>
                                            </div>
                                        </div>
                                        <div className="flex gap-2">
                                            <Button variant="outline" size="sm">
                                                <Icon name="archive" size={16} className="mr-2" />
                                                Archive
                                            </Button>
                                            <Button size="sm">
                                                <Icon name="reply" size={16} className="mr-2" />
                                                Reply
                                            </Button>
                                        </div>
                                    </div>
                                </div>
                                <div className="p-6 flex-1 overflow-y-auto whitespace-pre-wrap">
                                    {selectedMessage.body}
                                </div>
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center text-muted-foreground">
                                <Icon name="mail" size={48} className="mb-4 opacity-20" />
                                <p>Select a message to read</p>
                            </div>
                        )}
                    </Card>

                    {/* Compose Modal */}
                    <Modal
                        open={showCompose}
                        onClose={() => setShowCompose(false)}
                        title="New Message"
                        maxWidth="max-w-2xl"
                    >
                        <form className="space-y-4" onSubmit={(e) => {
                            e.preventDefault()
                            setShowCompose(false)
                        }}>
                            <div>
                                <label className="text-sm font-medium mb-1 block">Subject</label>
                                <Input placeholder="What is this regarding?" />
                            </div>
                            <div>
                                <label className="text-sm font-medium mb-1 block">Message</label>
                                <textarea
                                    rows={8}
                                    placeholder="Type your message..."
                                    className="mt-1 flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring"
                                />
                            </div>
                            <div className="flex gap-3">
                                <Button type="button" variant="outline" onClick={() => setShowCompose(false)} className="flex-1">
                                    Cancel
                                </Button>
                                <Button type="submit" className="flex-1">
                                    <Icon name="send" size={16} className="mr-2" />
                                    Send Message
                                </Button>
                            </div>
                        </form>
                    </Modal>
                </div>
            )
        }

        const ServicerDashboard = () => {
            const stats = [
                { title: 'Total Loans', value: '1,248', trend: 12, icon: 'folder' },
                { title: 'Active Delinquencies', value: '42', trend: -5, icon: 'alert-triangle' },
                { title: 'Pending Tasks', value: '18', trend: 8, icon: 'check-square' },
                { title: 'Total Portfolio', value: '$428.5M', trend: 4, icon: 'dollar-sign' },
            ]

            const recentActivity = [
                { id: 1, user: 'Sarah Johnson', action: 'Payment Received', time: '2 mins ago' },
                { id: 2, user: 'Michael Chen', action: 'Document Uploaded', time: '15 mins ago' },
                { id: 3, user: 'System', action: 'Escrow Analysis Complete', time: '1 hour ago' },
                { id: 4, user: 'David Wilson', action: 'Support Ticket Created', time: '2 hours ago' },
            ]

            return (
                <div className="space-y-6">
                    <div>
                        <h2 className="text-3xl font-bold">Servicer Overview</h2>
                        <p className="text-muted-foreground mt-1">
                            Portfolio performance and daily tasks
                        </p>
                    </div>

                    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                        {stats.map((stat, i) => (
                            <StatCard
                                key={i}
                                title={stat.title}
                                value={stat.value}
                                trend={stat.trend}
                                icon={{ name: stat.icon, bg: 'bg-primary/10', color: 'text-primary' }}
                            />
                        ))}
                    </div>

                    <div className="grid grid-cols-1 lg:grid-cols-3 gap-6">
                        <Card className="lg:col-span-2">
                            <h3 className="text-lg font-semibold mb-4">Portfolio Performance</h3>
                            <div className="h-64 flex items-center justify-center bg-muted/20 rounded-lg border border-dashed">
                                <p className="text-muted-foreground">Chart Placeholder</p>
                            </div>
                        </Card>

                        <Card>
                            <h3 className="text-lg font-semibold mb-4">Recent Activity</h3>
                            <div className="space-y-4">
                                {recentActivity.map((activity) => (
                                    <div key={activity.id} className="flex items-start gap-3 pb-3 border-b last:border-0 last:pb-0">
                                        <div className="p-2 bg-muted rounded-full">
                                            <Icon name="user" size={16} />
                                        </div>
                                        <div>
                                            <p className="font-medium text-sm">{activity.user}</p>
                                            <p className="text-xs text-muted-foreground">{activity.action}</p>
                                            <p className="text-xs text-muted-foreground mt-1">{activity.time}</p>
                                        </div>
                                    </div>
                                ))}
                            </div>
                        </Card>
                    </div>
                </div>
            )
        }

        const ServicerLoans = ({ loans }) => {
            const [searchTerm, setSearchTerm] = useState('')
            const [statusFilter, setStatusFilter] = useState('all')

            const filteredLoans = loans.filter(loan => {
                const matchesSearch = loan.borrower_name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                    loan.loan_number.includes(searchTerm) ||
                    loan.property_address.toLowerCase().includes(searchTerm.toLowerCase())
                const matchesStatus = statusFilter === 'all' || loan.status === statusFilter
                return matchesSearch && matchesStatus
            })

            const columns = [
                {
                    key: 'loan_number',
                    label: 'Loan Number',
                    render: (val) => <span className="font-medium">{val}</span>,
                },
                {
                    key: 'borrower_name',
                    label: 'Borrower',
                    render: (val, row) => (
                        <div>
                            <div className="font-medium">{val}</div>
                            <div className="text-xs text-muted-foreground">{row.email}</div>
                        </div>
                    ),
                },
                {
                    key: 'property_address',
                    label: 'Property',
                    className: 'max-w-xs truncate',
                },
                {
                    key: 'current_principal',
                    label: 'Balance',
                    className: 'text-right',
                    render: (val) => `$${val.toLocaleString()}`,
                },
                {
                    key: 'status',
                    label: 'Status',
                    render: (val) => (
                        <Badge variant={val === 'Current' ? 'success' : 'destructive'}>
                            {val}
                        </Badge>
                    ),
                },
                {
                    key: 'next_due_date',
                    label: 'Next Due',
                    render: (val) => new Date(val).toLocaleDateString(),
                },
                {
                    key: 'actions',
                    label: '',
                    render: () => (
                        <Button variant="ghost" size="sm">
                            <Icon name="more-horizontal" size={16} />
                        </Button>
                    ),
                },
            ]

            return (
                <div className="space-y-6">
                    <div className="flex items-center justify-between">
                        <div>
                            <h2 className="text-3xl font-bold">Loan Portfolio</h2>
                            <p className="text-muted-foreground mt-1">
                                Manage borrower loans and accounts
                            </p>
                        </div>
                        <Button>
                            <Icon name="plus" size={16} className="mr-2" />
                            Add New Loan
                        </Button>
                    </div>

                    <Card>
                        <div className="flex flex-col md:flex-row gap-4 mb-6">
                            <div className="flex-1 relative">
                                <Icon name="search" size={18} className="absolute left-3 top-3 text-muted-foreground" />
                                <Input
                                    placeholder="Search by name, loan number, or address..."
                                    value={searchTerm}
                                    onChange={(e) => setSearchTerm(e.target.value)}
                                    className="pl-10"
                                />
                            </div>
                            <div className="flex gap-2">
                                <select
                                    className="h-10 rounded-md border border-input bg-background px-3 py-2 text-sm"
                                    value={statusFilter}
                                    onChange={(e) => setStatusFilter(e.target.value)}
                                >
                                    <option value="all">All Statuses</option>
                                    <option value="Current">Current</option>
                                    <option value="Delinquent">Delinquent</option>
                                    <option value="Foreclosure">Foreclosure</option>
                                </select>
                                <Button variant="outline">
                                    <Icon name="filter" size={16} className="mr-2" />
                                    More Filters
                                </Button>
                            </div>
                        </div>

                        <DataTable columns={columns} data={filteredLoans} />
                    </Card>
                </div>
            )
        }

        // ============ MOCK DATA ============

        const mockLoans = [
            {
                id: 'loan_1',
                loan_number: '10001089',
                borrower_name: 'Sarah Johnson',
                email: 'sarah.johnson@email.com',
                phone: '(555) 123-4567',
                property_address: '123 Main Street, Springfield, IL 62701',
                loan_type: 'Conventional',
                original_balance: 350000,
                current_principal: 338500,
                interest_rate: 4.25,
                monthly_pi: 1720.14,
                monthly_escrow: 650.00,
                term_months: 360,
                months_remaining: 348,
                status: 'Current',
                next_due_date: '2024-01-01',
                last_payment_date: '2023-12-01',
                last_payment_amount: 2370.14,
                origination_date: '2023-01-15',
            },
            {
                id: 'loan_2',
                loan_number: '10001098',
                borrower_name: 'Michael Chen',
                email: 'michael.chen@email.com',
                phone: '(555) 234-5678',
                property_address: '456 Oak Avenue, Chicago, IL 60601',
                loan_type: 'FHA',
                original_balance: 285000,
                current_principal: 278400,
                interest_rate: 3.875,
                monthly_pi: 1340.25,
                monthly_escrow: 520.00,
                term_months: 360,
                months_remaining: 354,
                status: 'Current',
                next_due_date: '2024-01-01',
                last_payment_date: '2023-12-01',
                last_payment_amount: 1860.25,
                origination_date: '2023-07-10',
            },
        ]

        const mockTransactions = [
            {
                id: 'txn_1',
                loan_id: 'loan_1',
                date: '2023-12-01',
                type: 'Payment',
                amount: 2370.14,
                principal: 935.14,
                interest: 1435.00,
                escrow: 650.00,
                balance_after: 338500,
                status: 'Posted',
            },
            {
                id: 'txn_2',
                loan_id: 'loan_1',
                date: '2023-11-01',
                type: 'Payment',
                amount: 2370.14,
                principal: 931.81,
                interest: 1438.33,
                escrow: 650.00,
                balance_after: 339431.81,
                status: 'Posted',
            },
            {
                id: 'txn_3',
                loan_id: 'loan_1',
                date: '2023-10-01',
                type: 'Payment',
                amount: 2370.14,
                principal: 928.50,
                interest: 1441.64,
                escrow: 650.00,
                balance_after: 340363.62,
                status: 'Posted',
            },
            {
                id: 'txn_4',
                loan_id: 'loan_2',
                date: '2023-12-01',
                type: 'Payment',
                amount: 1860.25,
                principal: 957.55,
                interest: 902.70,
                escrow: 520.00,
                balance_after: 278400,
                status: 'Posted',
            },
        ]

        const mockDocuments = [
            {
                id: 'doc_1',
                loan_id: 'loan_1',
                name: 'Monthly Statement - December 2023',
                type: 'Statement',
                date: '2023-12-05',
                size: '245 KB',
                url: '#',
            },
            {
                id: 'doc_2',
                loan_id: 'loan_1',
                name: 'Monthly Statement - November 2023',
                type: 'Statement',
                date: '2023-11-05',
                size: '238 KB',
                url: '#',
            },
            {
                id: 'doc_3',
                loan_id: 'loan_1',
                name: '2023 Year-End Tax Statement',
                type: 'Tax Document',
                date: '2023-12-31',
                size: '156 KB',
                url: '#',
            },
            {
                id: 'doc_4',
                loan_id: 'loan_1',
                name: 'Loan Closing Disclosure',
                type: 'Disclosure',
                date: '2023-01-15',
                size: '892 KB',
                url: '#',
            },
        ]

        const mockMessages = [
            {
                id: 'msg_1',
                loan_id: 'loan_1',
                subject: 'Payment Received',
                preview: 'Thank you for your payment of $2,370.14. It has been posted to your account.',
                body: 'Dear Sarah Johnson,\n\nWe have received your payment of $2,370.14 for loan #10001089. It has been posted to your account effective December 1, 2023.\n\nBreakdown:\n- Principal: $935.14\n- Interest: $1,435.00\n- Escrow: $650.00\n\nThank you for your business.\n\nSincerely,\nServState Customer Service',
                date: '2023-12-01T10:30:00',
                sender: 'System',
                unread: true,
            },
            {
                id: 'msg_2',
                loan_id: 'loan_1',
                subject: 'Escrow Analysis Completed',
                preview: 'Your annual escrow analysis has been completed. No shortage found.',
                body: 'Dear Sarah Johnson,\n\nYour annual escrow analysis for the upcoming year has been completed. Based on the projected tax and insurance payments, we have determined that your current monthly escrow payment of $650.00 is sufficient.\n\nYou do not need to take any action at this time.\n\nSincerely,\nServState Escrow Department',
                date: '2023-11-15T14:20:00',
                sender: 'Escrow Dept',
                unread: true,
            },
            {
                id: 'msg_3',
                loan_id: 'loan_1',
                subject: 'Welcome to ServState',
                preview: 'Welcome to your new online account management portal.',
                body: 'Dear Sarah Johnson,\n\nWelcome to ServState! We are pleased to be servicing your mortgage loan.\n\nThrough this portal, you can:\n- Make payments\n- View transaction history\n- Download documents\n- Contact support\n\nIf you have any questions, please use the "Contact Support" button on your dashboard.\n\nSincerely,\nServState Onboarding Team',
                date: '2023-01-20T09:00:00',
                sender: 'Customer Service',
                unread: false,
            },
        ]

        // ============ MAIN APP COMPONENT ============
        const App = () => {
            const [viewMode, setViewMode] = useState('borrower')
            const [activeView, setActiveView] = useState('dashboard')
            const [sidebarCollapsed, setSidebarCollapsed] = useState(false)
            const [paymentModal, setPaymentModal] = useState(false)

            // Get current user's loan (first loan for prototype)
            const currentLoan = mockLoans[0]
            const loanTransactions = mockTransactions.filter(t => t.loan_id === currentLoan.id)
            const loanDocuments = mockDocuments.filter(d => d.loan_id === currentLoan.id)
            const loanMessages = mockMessages.filter(m => m.loan_id === currentLoan.id)

            const borrowerNav = [
                { id: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
                { id: 'payments', label: 'Payments', icon: 'credit-card' },
                { id: 'documents', label: 'Documents', icon: 'file-text' },
                { id: 'escrow', label: 'Escrow', icon: 'piggy-bank' },
                {
                    id: 'messages',
                    label: 'Messages',
                    icon: 'mail',
                    badge: loanMessages.filter(m => m.unread).length > 0
                        ? loanMessages.filter(m => m.unread).length.toString()
                        : null
                },
            ]

            const servicerNav = [
                { id: 'dashboard', label: 'Dashboard', icon: 'layout-dashboard' },
                { id: 'loans', label: 'Loans', icon: 'folder' },
                { id: 'delinquency', label: 'Delinquency', icon: 'alert-triangle', badge: '3' },
                { id: 'tasks', label: 'Tasks', icon: 'check-square' },
                { id: 'reports', label: 'Reports', icon: 'bar-chart-2' },
            ]

            const currentNav = viewMode === 'borrower' ? borrowerNav : servicerNav

            return (
                <div className="min-h-screen bg-background">
                    {/* Header */}
                    <header className="border-b bg-card sticky top-0 z-40">
                        <div className="container mx-auto px-4 py-4">
                            <div className="flex items-center justify-between">
                                <div className="flex items-center gap-4">
                                    <button
                                        onClick={() => setSidebarCollapsed(!sidebarCollapsed)}
                                        className="lg:hidden"
                                    >
                                        <Icon name="menu" size={24} />
                                    </button>
                                    <h1 className="text-2xl font-bold text-primary">ServState</h1>
                                </div>
                                <div className="flex items-center gap-4">
                                    <span className="text-sm text-muted-foreground hidden sm:block">
                                        {viewMode === 'borrower' ? currentLoan.borrower_name : 'Admin Portal'}
                                    </span>
                                    <Button
                                        variant="outline"
                                        size="sm"
                                        onClick={() => {
                                            setViewMode(viewMode === 'borrower' ? 'servicer' : 'borrower')
                                            setActiveView('dashboard')
                                        }}
                                    >
                                        <Icon name="repeat" size={14} className="mr-2" />
                                        Switch to {viewMode === 'borrower' ? 'Servicer' : 'Borrower'}
                                    </Button>
                                </div>
                            </div>
                        </div>
                    </header>

                    {/* Main Layout */}
                    <div className="flex">
                        {/* Sidebar */}
                        <Sidebar
                            items={currentNav}
                            activeView={activeView}
                            onNavigate={setActiveView}
                            collapsed={sidebarCollapsed}
                        />

                        {/* Main Content */}
                        <main className="flex-1 p-6">
                            {viewMode === 'borrower' && (
                                <>
                                    {activeView === 'dashboard' && (
                                        <BorrowerDashboard
                                            loan={currentLoan}
                                            transactions={loanTransactions}
                                            onMakePayment={() => setPaymentModal(true)}
                                        />
                                    )}
                                    {activeView === 'payments' && (
                                        <BorrowerPayments
                                            loan={currentLoan}
                                            transactions={loanTransactions}
                                            onMakePayment={() => setPaymentModal(true)}
                                        />
                                    )}
                                    {activeView === 'documents' && (
                                        <BorrowerDocuments documents={loanDocuments} />
                                    )}
                                    {activeView === 'escrow' && (
                                        <BorrowerEscrow loan={currentLoan} />
                                    )}
                                    {activeView === 'messages' && (
                                        <BorrowerMessages messages={loanMessages} />
                                    )}
                                    {activeView !== 'dashboard' && activeView !== 'payments' && activeView !== 'documents' && activeView !== 'escrow' && activeView !== 'messages' && (
                                        <Card>
                                            <h2 className="text-2xl font-bold mb-2">
                                                {currentNav.find(n => n.id === activeView)?.label}
                                            </h2>
                                            <p className="text-muted-foreground">Coming soon...</p>
                                        </Card>
                                    )}
                                </>
                            )}

                            {viewMode === 'servicer' && (
                                <>
                                    {activeView === 'dashboard' && <ServicerDashboard />}
                                    {activeView === 'loans' && <ServicerLoans loans={mockLoans} />}
                                    {activeView !== 'dashboard' && activeView !== 'loans' && (
                                        <Card>
                                            <h2 className="text-2xl font-bold mb-2">
                                                {currentNav.find(n => n.id === activeView)?.label}
                                            </h2>
                                            <p className="text-muted-foreground">Coming soon...</p>
                                        </Card>
                                    )}
                                </>
                            )}
                        </main>
                    </div>

                    <PaymentModal
                        open={paymentModal}
                        onClose={() => setPaymentModal(false)}
                        loan={currentLoan}
                        onSubmit={(amount) => {
                            console.log('Payment submitted:', amount)
                            // In real app, would process payment here
                        }}
                    />
                </div>
            )
        }
        // ============ RENDER APP ============
        ReactDOM.createRoot(document.getElementById('root')).render(<App />)
    </script>
</body>

</html>